use_guix() {
  mkdir -p "$(direnv_layout_dir)"
  local cache_dir="$(direnv_layout_dir)/.guix-profile"
  local channel_dir="$(direnv_layout_dir)/.guix-channels"
  watch_file guix.scm
  watch_file manifest.scm
  watch_file channels.scm
  if [ -f channels.scm ]
  then
    log_status "Using Guix version from channels.scm"
    PATH_add "$channel_dir/bin"
    guix pull -C channels.scm --profile="$channel_dir"
  fi
  eval "$(guix shell --root="$cache_dir" "$@" --search-paths)"
}
